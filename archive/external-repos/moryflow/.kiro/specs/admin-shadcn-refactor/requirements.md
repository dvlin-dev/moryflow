# 需求文档

## 简介

本文档定义了 moryflow-membership/admin 管理后台使用 shadcn/ui 进行重构的需求规范。该管理后台是 Moryflow 会员管理系统的前端界面，用于管理用户、积分、会员等级、AI 模型提供商等功能。重构目标是采用 shadcn/ui 组件库，提升 UI 一致性和开发效率，同时完善现有功能。

## 术语表

- **管理后台系统**: Moryflow 会员管理后台系统
- **shadcn/ui**: 基于 Radix UI 和 Tailwind CSS 的可复用组件库
- **仪表盘**: 系统概览页面，展示统计数据和健康状态
- **用户管理**: 用户管理模块，包含用户列表、详情、等级设置、积分发放
- **提供商**: AI 模型提供商（如 OpenAI、Anthropic）
- **模型**: AI 模型配置（如 gpt-4、claude-3）
- **等级**: 用户等级（free/basic/pro/license）
- **积分**: 积分系统，包含订阅积分和购买积分
- **操作日志**: 管理员操作日志

## 需求列表

### 需求 1: shadcn/ui 组件库集成

**用户故事:** 作为开发者，我希望将 shadcn/ui 组件库集成到管理后台项目中，以便在整个应用中使用一致、高质量的 UI 组件。

#### 验收标准

1. 当开发者运行 shadcn 初始化命令时，管理后台系统应创建必要的配置文件（components.json、tailwind 配置更新）
2. 当添加 shadcn 组件时，管理后台系统应将组件放置在专用的 `src/components/ui` 目录中，避免与现有自定义组件冲突
3. 当现有自定义组件与 shadcn 组件冲突时，管理后台系统应将自定义组件迁移为使用 shadcn 原语，同时保留现有功能
4. 当配置 shadcn 主题时，管理后台系统应遵循 Arc + Notion 视觉风格指南（圆角、黑白灰色调、微妙阴影）

### 需求 2: 登录页面重构

**用户故事:** 作为管理员，我希望有一个精美的登录页面，以便能够以专业的用户体验安全地访问管理系统。

#### 验收标准

1. 当登录页面加载时，管理后台系统应使用 shadcn 表单组件显示居中的登录表单，包含邮箱和密码字段
2. 当管理员提交有效凭据时，管理后台系统应通过 POST /admin/login 进行认证并重定向到仪表盘
3. 当管理员提交无效凭据时，管理后台系统应使用 shadcn toast 组件显示错误消息
4. 当登录表单正在加载时，管理后台系统应禁用提交按钮并显示加载指示器
5. 当登录页面渲染时，管理后台系统应使用 shadcn login-04 block 布局作为基础模板

### 需求 3: 仪表盘页面重构

**用户故事:** 作为管理员，我希望有一个全面的仪表盘，以便能够快速查看系统统计数据和健康状态。

#### 验收标准

1. 当仪表盘加载时，管理后台系统应使用 shadcn card 组件显示统计卡片，展示总用户数、积分消耗、API 调用量和付费用户数
2. 当仪表盘加载时，管理后台系统应显示系统健康状态（数据库、KV 存储），使用颜色编码指示器
3. 当仪表盘加载时，管理后台系统应以可视化格式显示用户等级分布
4. 当仪表盘布局渲染时，管理后台系统应使用 shadcn dashboard-01 block 作为基础模板，包含侧边栏导航
5. 当统计数据正在加载时，管理后台系统应使用 shadcn skeleton 组件显示骨架加载状态

### 需求 4: 侧边栏导航重构

**用户故事:** 作为管理员，我希望有一个一致的侧边栏导航，以便能够轻松地在管理系统的不同部分之间导航。

#### 验收标准

1. 当布局渲染时，管理后台系统应显示侧边栏，包含到仪表盘、用户、提供商、模型和日志的导航链接
2. 当导航项处于活动状态时，管理后台系统应在侧边栏中高亮显示当前页面
3. 当用户点击退出按钮时，管理后台系统应清除认证状态并重定向到登录页面
4. 当侧边栏渲染时，管理后台系统应显示 Moryflow 品牌标志和管理员用户信息

### 需求 5: 用户管理页面重构

**用户故事:** 作为管理员，我希望能够有效地管理用户，以便能够查看、搜索和修改用户信息。

#### 验收标准

1. 当用户页面加载时，管理后台系统应使用 shadcn table 组件显示分页的用户表格，包含邮箱、等级、积分余额和创建日期列
2. 当管理员搜索用户时，管理后台系统应按邮箱或名称过滤用户列表
3. 当管理员按等级筛选时，管理后台系统应仅显示匹配所选等级的用户
4. 当管理员点击用户行时，管理后台系统应导航到用户详情页面
5. 当用户列表正在加载时，管理后台系统应显示表格骨架加载状态

### 需求 6: 用户详情页面重构

**用户故事:** 作为管理员，我希望能够查看和修改用户详情，以便能够管理单个用户账户。

#### 验收标准

1. 当用户详情页面加载时，管理后台系统应显示用户信息，包括邮箱、等级、积分明细（每日/订阅/购买）和 API 密钥
2. 当管理员点击"设置等级"时，管理后台系统应使用 shadcn dialog 和 select 组件打开对话框，选择新等级（free/basic/pro/license）
3. 当管理员点击"发放积分"时，管理后台系统应打开对话框，指定积分类型（订阅/购买）、数量和过期日期
4. 当提交等级变更时，管理后台系统应调用 POST /admin/users/:id/tier 并刷新用户数据
5. 当发放积分时，管理后台系统应调用 POST /admin/users/:id/credits 并刷新用户数据

### 需求 7: AI 提供商管理页面

**用户故事:** 作为管理员，我希望能够管理 AI 提供商，以便能够配置系统中可用的 AI 服务。

#### 验收标准

1. 当提供商页面加载时，管理后台系统应使用 shadcn card 组件显示已配置的 AI 提供商列表（OpenAI、Anthropic 等）
2. 当管理员点击"添加提供商"时，管理后台系统应打开表单对话框，配置新提供商的名称、API 端点和 API 密钥字段
3. 当管理员编辑提供商时，管理后台系统应允许修改提供商设置
4. 当管理员切换提供商状态时，管理后台系统应使用 shadcn switch 组件启用或禁用提供商
5. 当获取提供商数据时，管理后台系统应调用 GET /admin/providers API 端点

### 需求 8: AI 模型管理页面

**用户故事:** 作为管理员，我希望能够管理 AI 模型，以便能够为不同用户等级配置模型可用性和定价。

#### 验收标准

1. 当模型页面加载时，管理后台系统应使用 shadcn table 组件显示 AI 模型表格，包含名称、提供商、等级要求和定价列
2. 当管理员点击"添加模型"时，管理后台系统应打开表单对话框，配置新模型的名称、提供商选择、等级要求和 token 定价
3. 当管理员编辑模型时，管理后台系统应允许修改模型设置，包括等级访问权限和定价
4. 当管理员切换模型状态时，管理后台系统应启用或禁用该模型
5. 当获取模型数据时，管理后台系统应调用 GET /admin/models API 端点

### 需求 9: 操作日志页面重构

**用户故事:** 作为管理员，我希望能够查看操作日志，以便能够审计管理操作。

#### 验收标准

1. 当日志页面加载时，管理后台系统应使用 shadcn table 组件显示分页的管理日志表格，包含时间戳、操作者、操作类型、目标用户和详情列
2. 当管理员按操作类型筛选日志时，管理后台系统应仅显示匹配的日志条目
3. 当管理员按日期范围筛选日志时，管理后台系统应使用 shadcn date picker 组件显示指定时间段内的日志
4. 当管理员点击日志条目时，管理后台系统应在对话框中显示完整的 JSON 详情
5. 当获取日志数据时，管理后台系统应调用 GET /admin/logs API 端点，带有分页和筛选参数

### 需求 10: 表单验证与错误处理

**用户故事:** 作为管理员，我希望有清晰的表单验证和错误反馈，以便能够轻松纠正输入错误。

#### 验收标准

1. 当表单字段有验证错误时，管理后台系统应使用 shadcn 表单错误样式显示内联错误消息
2. 当 API 请求失败时，管理后台系统应使用 shadcn sonner 集成显示带有描述性消息的错误 toast
3. 当 API 请求成功时，管理后台系统应显示确认操作的成功 toast
4. 当提交表单数据时，管理后台系统应在发送到 API 之前使用 Zod 模式验证输入

### 需求 11: 响应式布局

**用户故事:** 作为管理员，我希望管理界面能够在不同屏幕尺寸上工作，以便能够从各种设备管理系统。

#### 验收标准

1. 当视口宽度小于 768px 时，管理后台系统应将侧边栏折叠为移动菜单
2. 当视口宽度小于 768px 时，管理后台系统应堆叠表格列或对数据表格使用水平滚动
3. 当视口宽度变化时，管理后台系统应在布局模式之间平滑过渡
4. 当显示卡片时，管理后台系统应使用响应式网格布局，适应屏幕宽度

### 需求 12: 数据刷新与缓存

**用户故事:** 作为管理员，我希望数据能够保持最新而无需手动刷新，以便能够看到最新信息。

#### 验收标准

1. 当显示仪表盘时，管理后台系统应每 30 秒自动刷新健康状态
2. 当变更操作（创建/更新/删除）成功时，管理后台系统应使相关查询缓存失效并重新获取数据
3. 当用户导航回某个页面时，管理后台系统应使用缓存数据（如果可用且新鲜），否则重新获取
4. 当数据过期时，管理后台系统应显示微妙的指示器并允许手动刷新
