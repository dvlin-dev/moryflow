# =============================================
# Aiget Server 环境变量配置
# =============================================
#
# 说明：
#   [必选] - 服务运行必须配置
#   [可选] - 有默认值或功能可选
#
# 使用方法：
#   1. 复制此文件为 .env
#   2. 填写所有 [必选] 项
#   3. 根据需要修改 [可选] 项
#

# =============================================
# 核心配置
# =============================================

# [必选] 主库数据库连接字符串（PostgreSQL）
DATABASE_URL="postgresql://user:password@localhost:5432/aiget?schema=public"

# [必选] 向量库数据库连接字符串（pgvector）
VECTOR_DATABASE_URL="postgresql://user:password@localhost:5433/aiget_vector?schema=public"

# [必选] Redis 连接字符串
REDIS_URL="redis://default:password@localhost:6379"

# [可选] Redis 主机地址（如果不使用 REDIS_URL）
REDIS_HOST="localhost"

# [可选] Redis 端口（默认 6379）
REDIS_PORT="6379"

# [可选] 运行环境（development | production）
NODE_ENV="development"

# [可选] 服务端口（默认 3000）
PORT="3000"

# =============================================
# Better Auth 认证配置
# =============================================

# [必选] Better Auth 密钥（用于 JWT 签名，建议使用 openssl rand -base64 32 生成）
BETTER_AUTH_SECRET=""

# [必选] Better Auth URL（服务器公网地址）
BETTER_AUTH_URL="https://server.aiget.dev"

# [必选] 管理员密码
ADMIN_PASSWORD=""

# =============================================
# CORS 跨域配置
# =============================================

# [必选] 允许的前端来源（逗号分隔）
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:5173,http://localhost:5174,https://console.aiget.dev,https://admin.aiget.dev,https://aiget.dev"

# [必选] Better Auth 信任的来源（用于 CSRF 保护，逗号分隔）
TRUSTED_ORIGINS="http://localhost:3000,http://localhost:5173,http://localhost:5174,https://console.aiget.dev,https://admin.aiget.dev,https://aiget.dev"

# =============================================
# 服务器 URL
# =============================================

# [必选] 服务器公网 URL（用于生成预签名 URL、回调地址等）
SERVER_URL="https://server.aiget.dev"

# =============================================
# Creem 支付（可选功能）
# =============================================

# [可选] Creem API Key（不使用支付功能可留空）
CREEM_API_KEY=""

# [可选] Creem Webhook 密钥
CREEM_WEBHOOK_SECRET=""

# [可选] Creem 测试模式（true | false）
CREEM_TEST_MODE="true"

# =============================================
# Billing 扣费规则覆盖
# =============================================

# [可选] JSON 字符串，对应 src/billing/billing.rules.ts
BILLING_RULE_OVERRIDES_JSON=""

# =============================================
# Browser Pool（Playwright）
# =============================================

# [可选] 浏览器池大小 (1-32)
BROWSER_POOL_SIZE=""

# [可选] 预热浏览器数量 (1-8)
BROWSER_WARMUP_COUNT=""

# [可选] 单个浏览器最大页面数 (1-50)
MAX_PAGES_PER_BROWSER=""

# [可选] 空闲回收时间（秒，60-3600）
BROWSER_IDLE_TIMEOUT=""

# =============================================
# Cloudflare R2 存储（云同步功能）
# =============================================

# [可选] R2 账户 ID（不使用云存储可留空）
R2_ACCOUNT_ID=""

# [可选] R2 Access Key ID
R2_ACCESS_KEY_ID=""

# [可选] R2 Secret Access Key
R2_SECRET_ACCESS_KEY=""

# [可选] 存储 API 密钥
STORAGE_API_SECRET=""

# [可选] R2 存储桶名称
R2_BUCKET_NAME=""

# [可选] R2 公开访问 URL
R2_PUBLIC_URL=""

# =============================================
# Resend 邮件服务（邮箱验证功能）
# =============================================

# [可选] Resend API Key（不使用邮箱验证可留空）
# 获取地址：https://resend.com/api-keys
RESEND_API_KEY=""

# [可选] 发件人地址
EMAIL_FROM="Aiget <noreply@yourdomain.com>"

# =============================================
# Cloudflare Turnstile（验证码功能）
# =============================================

# [可选] Turnstile Site Key（不使用验证码可留空）
# 获取地址：https://dash.cloudflare.com/?to=/:account/turnstile
TURNSTILE_SITE_KEY=""

# [可选] Turnstile Secret Key
TURNSTILE_SECRET_KEY=""

# =============================================
# Scraper 模块配置
# =============================================

# [可选] 抓取结果缓存 TTL（毫秒，默认 3600000 = 1 小时）
SCRAPE_CACHE_TTL_MS=3600000

# =============================================
# Search 模块配置（SearXNG）
# =============================================

# [可选] SearXNG 实例地址（不使用搜索功能可留空）
# 注意：填写基础 URL，不要包含 /search 路径
# 示例：https://search.example.com
SEARXNG_URL=""

# [可选] 搜索重试次数（默认 3）
SEARCH_RETRY_COUNT=3

# [可选] 搜索重试延迟（毫秒，默认 1000）
SEARCH_RETRY_DELAY=1000

# [可选] 搜索结果抓取并发数（默认 5）
SEARCH_CONCURRENCY=5

# =============================================
# Extract 模块配置（LLM 提取）
# =============================================

# [可选] OpenAI API Key（不使用 Extract 功能可留空）
OPENAI_API_KEY=""

# [可选] OpenAI Base URL（用于自定义 endpoint，如 Azure OpenAI、DeepSeek 等）
# 留空则使用 OpenAI 官方 API: https://api.openai.com/v1
# 示例：
#   Azure OpenAI: https://your-resource.openai.azure.com/openai/deployments/your-deployment
#   DeepSeek: https://api.deepseek.com/v1
#   Ollama 本地: http://localhost:11434/v1
OPENAI_BASE_URL=""

# [可选] 默认 LLM 模型（默认 gpt-4o-mini）
OPENAI_DEFAULT_MODEL="gpt-4o-mini"

# [可选] 提取并发数（默认 5）
EXTRACT_CONCURRENCY=5

# =============================================
# Crawler 模块配置
# =============================================

# [可选] 爬取批量大小（默认 10）
CRAWL_BATCH_SIZE=10

# =============================================
# BatchScrape 模块配置
# =============================================

# [可选] 批量抓取并发数（默认 5）
BATCH_SCRAPE_CONCURRENCY=5

# =============================================
# Map 模块配置
# =============================================

# [可选] 最大爬取页面数（默认 100）
MAP_MAX_CRAWL_PAGES=100

# =============================================
# Webhook 配置
# =============================================

# [可选] Webhook 签名密钥（用于 HMAC-SHA256 签名）
# 建议使用 openssl rand -hex 32 生成
# 留空则不对 Webhook 请求签名
WEBHOOK_SECRET=""
