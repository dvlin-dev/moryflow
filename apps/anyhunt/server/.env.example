# =============================================
# Anyhunt Server 环境变量配置
# =============================================
#
# 说明：
#   [必选] - 服务运行必须配置
#   [可选] - 有默认值或功能可选
#
# 使用方法：
#   1. 复制此文件为 .env
#   2. 填写所有 [必选] 项
#   3. 根据需要修改 [可选] 项
#

# =============================================
# 核心配置
# =============================================

# [必选] 主库数据库连接字符串（PostgreSQL）
DATABASE_URL="postgresql://user:password@localhost:5432/db?schema=public"

# [必选] 向量库数据库连接字符串（pgvector）
VECTOR_DATABASE_URL="postgresql://user:password@localhost:5433/vector?schema=public"

# [可选] Prisma Shadow DB（本地迁移 diff 使用）
SHADOW_DATABASE_URL="postgresql://user:password@localhost:5432/db_shadow?schema=public"

# [可选] 向量库 Shadow DB（本地迁移 diff 使用）
VECTOR_SHADOW_DATABASE_URL="postgresql://user:password@localhost:5433/vector_shadow?schema=public"

# [必选] Redis 连接字符串
REDIS_URL="redis://default:password@localhost:6379"

# [可选] Redis 主机地址（如果不使用 REDIS_URL）
REDIS_HOST="localhost"

# [可选] Redis 端口（默认 6379）
REDIS_PORT="6379"

# [可选] 运行环境（development | production）
NODE_ENV="development"

# [可选] 服务端口（默认 3000）
PORT="3000"

# =============================================
# Better Auth 认证配置
# =============================================

# [必选] Better Auth 密钥（用于 JWT 签名，建议使用 openssl rand -base64 32 生成）
BETTER_AUTH_SECRET=""

# [必选] Better Auth URL（服务器公网地址）
BETTER_AUTH_URL="https://server.anyhunt.app"

# [必选] 管理员邮箱白名单（逗号分隔；注册后自动授予管理员权限）
ADMIN_EMAILS="admin@dvlin.com"

# =============================================
# CORS 跨域配置
# =============================================

# [必选] 允许的前端来源（逗号分隔）
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:5173,http://localhost:5174,https://console.anyhunt.app,https://admin.anyhunt.app,https://anyhunt.app"

# [必选] Better Auth 信任的来源（用于 CSRF 保护，逗号分隔）
TRUSTED_ORIGINS="http://localhost:3000,http://localhost:5173,http://localhost:5174,https://console.anyhunt.app,https://admin.anyhunt.app,https://anyhunt.app"

# =============================================
# 服务器 URL
# =============================================

# [必选] 服务器公网 URL（用于生成预签名 URL、回调地址等）
SERVER_URL="https://server.anyhunt.app"

# [可选] Anyhunt Dev WWW URL（用于 Digest 邮件中的查看/退订链接）
# 生产环境建议保持为 https://anyhunt.app
ANYHUNT_WWW_URL="https://anyhunt.app"

# =============================================
# Creem 支付（可选功能）
# =============================================

# [可选] Creem API Key（不使用支付功能可留空）
CREEM_API_KEY=""

# [可选] Creem Webhook 密钥
CREEM_WEBHOOK_SECRET=""

# [可选] Creem 测试模式（true | false）
CREEM_TEST_MODE="true"

# [可选] Creem 产品映射（JSON，占位）
# 订阅产品：productId -> tier
# CREEM_SUBSCRIPTION_PRODUCTS_JSON='{"prod_basic_monthly":{"tier":"BASIC"}}'
# 配额产品：productId -> amount/price/currency
# CREEM_QUOTA_PRODUCTS_JSON='{"prod_quota_1000":{"amount":1000,"price":9900,"currency":"USD"}}'

# =============================================
# Billing 扣费规则覆盖
# =============================================

# [可选] JSON 字符串，对应 src/billing/billing.rules.ts
BILLING_RULE_OVERRIDES_JSON=""

# =============================================
# Browser Pool（Playwright）
# =============================================

# [可选] 浏览器池大小 (1-32)
BROWSER_POOL_SIZE=""

# [可选] 预热浏览器数量 (1-8)
BROWSER_WARMUP_COUNT=""

# [可选] 单个浏览器最大页面数 (1-50)
MAX_PAGES_PER_BROWSER=""

# [可选] 空闲回收时间（秒，60-3600）
BROWSER_IDLE_TIMEOUT=""

# [可选] 允许的 CDP 主机（逗号分隔；空表示禁用 CDP）
BROWSER_CDP_ALLOWED_HOSTS=""

# [可选] 是否允许通过 port 获取 CDP wsEndpoint（默认 false；需配合 allowlist + 私网开关）
BROWSER_CDP_ALLOW_PORT="false"

# [可选] 是否允许私网/本地主机的 CDP 连接（默认 false）
BROWSER_CDP_ALLOW_PRIVATE_HOSTS="false"

# [可选] Browser Streaming WebSocket 端口（不设置则禁用）
BROWSER_STREAM_PORT=""

# [可选] Browser Streaming 对外访问 Host（默认 localhost）
BROWSER_STREAM_HOST="localhost"

# [可选] Browserbase Provider（CDP 远程浏览器）
BROWSERBASE_API_KEY=""
BROWSERBASE_PROJECT_ID=""

# [可选] Browser Use Provider（CDP 远程浏览器）
BROWSER_USE_API_KEY=""

# =============================================
# Cloudflare R2 存储（云同步功能）
# =============================================

# [可选] R2 账户 ID（不使用云存储可留空）
R2_ACCOUNT_ID=""

# [可选] R2 Access Key ID
R2_ACCESS_KEY_ID=""

# [可选] R2 Secret Access Key
R2_SECRET_ACCESS_KEY=""

# [可选] 存储 API 密钥
STORAGE_API_SECRET=""

# [可选] R2 存储桶名称
R2_BUCKET_NAME=""

# [可选] R2 公开访问 URL
R2_PUBLIC_URL="https://cdn.anyhunt.app"

# =============================================
# Resend 邮件服务（邮箱验证功能）
# =============================================

# [可选] Resend API Key（不使用邮箱验证可留空）
# 获取地址：https://resend.com/api-keys
RESEND_API_KEY=""

# [可选] 发件人地址
EMAIL_FROM="Anyhunt <noreply@anyhunt.app>"

# =============================================
# Cloudflare Turnstile（验证码功能）
# =============================================

# [可选] Turnstile Site Key（不使用验证码可留空）
# 获取地址：https://dash.cloudflare.com/?to=/:account/turnstile
TURNSTILE_SITE_KEY=""

# [可选] Turnstile Secret Key
TURNSTILE_SECRET_KEY=""

# =============================================
# Scraper 模块配置
# =============================================

# [可选] 抓取结果缓存 TTL（毫秒，默认 3600000 = 1 小时）
SCRAPE_CACHE_TTL_MS=3600000

# =============================================
# Search 模块配置（SearXNG）
# =============================================

# [可选] SearXNG 实例地址（不使用搜索功能可留空）
# 注意：填写基础 URL，不要包含 /search 路径
# 示例：https://search.example.com
SEARXNG_URL=""

# [可选] 搜索重试次数（默认 3）
SEARCH_RETRY_COUNT=3

# [可选] 搜索重试延迟（毫秒，默认 1000）
SEARCH_RETRY_DELAY=1000

# [可选] 搜索结果抓取并发数（默认 5）
SEARCH_CONCURRENCY=5

# =============================================
# Embedding 模块配置（OpenAI embeddings）
# =============================================

# [必选] Embedding Provider API Key（用于 Embedding 模块；Agent/Extract/Digest 不使用这些变量）
EMBEDDING_OPENAI_API_KEY=""

# [可选] Embedding Provider Base URL（OpenAI-compatible endpoint）
EMBEDDING_OPENAI_BASE_URL=""

# [可选] Embedding Model（默认 text-embedding-3-small）
EMBEDDING_OPENAI_MODEL="text-embedding-3-small"

# =============================================
# Extract 模块配置
# =============================================

# [可选] 提取并发数（默认 5）
EXTRACT_CONCURRENCY=5

# =============================================
# LLM Providers/Models（Admin 动态配置）
# =============================================
#
# 用于加密存储在数据库中的 LLM Provider API Key（AES-256-GCM）。
# 必须是 base64 编码的 32 bytes（示例生成：`node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"`）
ANYHUNT_LLM_SECRET_KEY=""

# =============================================
# Crawler 模块配置
# =============================================

# [可选] 爬取批量大小（默认 10）
CRAWL_BATCH_SIZE=10

# =============================================
# BatchScrape 模块配置
# =============================================

# [可选] 批量抓取并发数（默认 5）
BATCH_SCRAPE_CONCURRENCY=5

# =============================================
# Map 模块配置
# =============================================

# [可选] 最大爬取页面数（默认 100）
MAP_MAX_CRAWL_PAGES=100

# =============================================
# Webhook 配置
# =============================================

# [可选] Webhook 签名密钥（用于 HMAC-SHA256 签名）
# 建议使用 openssl rand -hex 32 生成
# 留空则不对 Webhook 请求签名
WEBHOOK_SECRET=""
