---
title: Webhooks
description: Configure webhooks for async job notifications
---

# Webhooks

Webhooks notify your application when long-running operations complete. Instead of polling for results, receive a POST request when the job is done.

## Supported Endpoints

| API | Webhook Support |
|-----|-----------------|
| Scrape API | No (synchronous) |
| Crawl API | Yes |
| Batch Scrape API | Yes |

## Configuration

Add a `webhookUrl` to your request:

```json
{
  "url": "https://example.com",
  "webhookUrl": "https://your-app.com/webhooks/anyhunt"
}
```

## Webhook Payload

When a job completes, Anyhunt sends a POST request to your webhook URL.

### Crawl Completed

```json
{
  "event": "crawl.completed",
  "data": {
    "id": "crawl_abc123",
    "status": "COMPLETED",
    "startUrl": "https://example.com",
    "totalUrls": 45,
    "completedUrls": 43,
    "failedUrls": 2
  },
  "timestamp": "2024-01-15T10:32:15.000Z"
}
```

### Crawl Failed

```json
{
  "event": "crawl.failed",
  "data": {
    "id": "crawl_abc123",
    "status": "FAILED",
    "error": "Too many consecutive failures"
  },
  "timestamp": "2024-01-15T10:35:00.000Z"
}
```

### Batch Scrape Completed

```json
{
  "event": "batch.completed",
  "data": {
    "id": "batch_abc123",
    "status": "COMPLETED",
    "totalUrls": 10,
    "completedUrls": 9,
    "failedUrls": 1
  },
  "timestamp": "2024-01-15T10:30:15.000Z"
}
```

## Handling Webhooks

### Node.js / Express

```javascript
const express = require('express');
const app = express();

app.use(express.json());

app.post('/webhooks/anyhunt', (req, res) => {
  const { event, data, timestamp } = req.body;

  console.log(`Received ${event} at ${timestamp}`);

  switch (event) {
    case 'crawl.completed':
      handleCrawlComplete(data);
      break;
    case 'batch.completed':
      handleBatchComplete(data);
      break;
    case 'crawl.failed':
    case 'batch.failed':
      handleJobFailed(data);
      break;
  }

  res.status(200).send('OK');
});

async function handleCrawlComplete(data) {
  // Fetch full results
  const response = await fetch(
    `https://server.anyhunt.app/api/v1/crawl/${data.id}`,
    { headers: { 'Authorization': 'Bearer ah_your_api_key' } }
  );
  const result = await response.json();

  // Process crawl results
  console.log(`Crawl complete: ${data.completedUrls} pages`);
}
```

### Python / Flask

```python
from flask import Flask, request, jsonify
import requests

app = Flask(__name__)

@app.route('/webhooks/anyhunt', methods=['POST'])
def handle_webhook():
    payload = request.json
    event = payload['event']
    data = payload['data']

    print(f"Received {event}: {data['id']}")

    if event == 'crawl.completed':
        handle_crawl_complete(data)
    elif event == 'batch.completed':
        handle_batch_complete(data)

    return jsonify({'status': 'ok'}), 200

def handle_crawl_complete(data):
    # Fetch full results
    response = requests.get(
        f"https://server.anyhunt.app/api/v1/crawl/{data['id']}",
        headers={'Authorization': 'Bearer ah_your_api_key'}
    )
    result = response.json()

    # Process crawl results
    print(f"Crawl complete: {data['completedUrls']} pages")
```

## Webhook Requirements

### Endpoint Requirements

1. **HTTPS** - Webhook URLs must use HTTPS
2. **Respond quickly** - Return 2xx within 30 seconds
3. **Idempotent** - Handle duplicate deliveries gracefully

### Response Codes

| Status | Meaning |
|--------|---------|
| 2xx | Success - webhook received |
| 4xx | Client error - won't retry |
| 5xx | Server error - will retry |

## Retry Policy

If your webhook endpoint fails, Anyhunt retries:

| Attempt | Delay |
|---------|-------|
| 1st retry | 1 minute |
| 2nd retry | 5 minutes |
| 3rd retry | 30 minutes |
| 4th retry | 2 hours |
| 5th retry | 24 hours |

After 5 retries, the webhook is marked as failed.

## Best Practices

1. **Respond immediately** - Process asynchronously after responding
2. **Verify the source** - Check request headers/payload
3. **Handle duplicates** - Same webhook may be delivered multiple times
4. **Log everything** - Keep records for debugging
5. **Use queues** - Offload processing to background workers

## Example: Complete Workflow

```javascript
// 1. Start a crawl with webhook
const crawlResponse = await fetch('https://server.anyhunt.app/api/v1/crawl', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ah_your_api_key',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    url: 'https://docs.example.com',
    maxDepth: 3,
    webhookUrl: 'https://your-app.com/webhooks/anyhunt'
  }),
});

const { data: crawl } = await crawlResponse.json();
console.log(`Crawl started: ${crawl.id}`);

// 2. Your webhook handler receives the result
// (No polling needed!)
```
